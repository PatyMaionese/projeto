if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading"){
	StandoutJS();
} else {
	document.addEventListener('DOMContentLoaded', StandoutJS);
}

function StandoutJS(){
	
	var bot=false;
	var botPattern = "(googlebot\/|Googlebot-Mobile|Googlebot-Image|Google favicon|Mediapartners-Google|bingbot|slurp|java|wget|curl|Commons-HttpClient|Python-urllib|libwww|httpunit|nutch|phpcrawl|msnbot|jyxobot|FAST-WebCrawler|FAST Enterprise Crawler|biglotron|teoma|convera|seekbot|gigablast|exabot|ngbot|ia_archiver|GingerCrawler|webmon |httrack|webcrawler|grub.org|UsineNouvelleCrawler|antibot|netresearchserver|speedy|fluffy|bibnum.bnf|findlink|msrbot|panscient|yacybot|AISearchBot|IOI|ips-agent|tagoobot|MJ12bot|dotbot|woriobot|yanga|buzzbot|mlbot|yandexbot|purebot|Linguee Bot|Voyager|CyberPatrol|voilabot|baiduspider|citeseerxbot|spbot|twengabot|postrank|turnitinbot|scribdbot|page2rss|sitebot|linkdex|Adidxbot|blekkobot|ezooms|dotbot|Mail.RU_Bot|discobot|heritrix|findthatfile|europarchive.org|NerdByNature.Bot|sistrix crawler|ahrefsbot|Aboundex|domaincrawler|wbsearchbot|summify|ccbot|edisterbot|seznambot|ec2linkfinder|gslfbot|aihitbot|intelium_bot|facebookexternalhit|yeti|RetrevoPageAnalyzer|lb-spider|sogou|lssbot|careerbot|wotbox|wocbot|ichiro|DuckDuckBot|lssrocketcrawler|drupact|webcompanycrawler|acoonbot|openindexspider|gnam gnam spider|web-archive-net.com.bot|backlinkcrawler|coccoc|integromedb|content crawler spider|toplistbot|seokicks-robot|it2media-domain-crawler|ip-web-crawler.com|siteexplorer.info|elisabot|proximic|changedetection|blexbot|arabot|WeSEE:Search|niki-bot|CrystalSemanticsBot|rogerbot|360Spider|psbot|InterfaxScanBot|Lipperhey SEO Service|CC Metadata Scaper|g00g1e.net|GrapeshotCrawler|urlappendbot|brainobot|fr-crawler|binlar|SimpleCrawler|Livelapbot|Twitterbot|cXensebot|smtbot|bnf.fr_bot|A6-Indexer|ADmantX|Facebot|Twitterbot|OrangeBot|memorybot|AdvBot|MegaIndex|SemanticScholarBot|ltx71|nerdybot|xovibot|BUbiNG|Qwantify|archive.org_bot|Applebot|TweetmemeBot|crawler4j|findxbot|SemrushBot|yoozBot|lipperhey|y!j-asr|Domain Re-Animator Bot|AddThis)";
	var re = new RegExp(botPattern, 'i');
	var userAgent = navigator.userAgent;
	if (re.test(userAgent)) {
	  bot=true;
	}

	var nVer = navigator.appVersion;
	var nAgt = navigator.userAgent;
	var browserName  = navigator.appName;
	var fullVersion  = ''+parseFloat(navigator.appVersion); 
	var majorVersion = parseInt(navigator.appVersion,10);
	var nameOffset,verOffset,ix;

	if ((verOffset=nAgt.indexOf('OPR/'))!=-1) {
	 browserName = 'Opera';
	 fullVersion = nAgt.substring(verOffset+4);
	}
   
	else if ((verOffset=nAgt.indexOf('Opera'))!=-1) {
	 browserName = 'Opera';
	 fullVersion = nAgt.substring(verOffset+6);
	 if ((verOffset=nAgt.indexOf('Version'))!=-1) 
	   fullVersion = nAgt.substring(verOffset+8);
	}
   
	else if ((verOffset=nAgt.indexOf('MSIE'))!=-1) {
	 browserName = 'Microsoft Internet Explorer';
	 fullVersion = nAgt.substring(verOffset+5);
	}
   
	else if ((verOffset=nAgt.indexOf('Chrome'))!=-1) {
	 browserName = 'Chrome';
	 fullVersion = nAgt.substring(verOffset+7);
	}
   
	else if ((verOffset=nAgt.indexOf('Safari'))!=-1) {
	 browserName = 'Safari';
	 fullVersion = nAgt.substring(verOffset+7);
	 if ((verOffset=nAgt.indexOf('Version'))!=-1) 
	   fullVersion = nAgt.substring(verOffset+8);
	}
   
	else if ((verOffset=nAgt.indexOf('Firefox'))!=-1) {
	 browserName = 'Firefox';
	 fullVersion = nAgt.substring(verOffset+8);
	}
   
	else if ( (nameOffset=nAgt.lastIndexOf(' ')+1) < 
			  (verOffset=nAgt.lastIndexOf('/')) ) 
	{
	 browserName = nAgt.substring(nameOffset,verOffset);
	 fullVersion = nAgt.substring(verOffset+1);
	 if (browserName.toLowerCase()==browserName.toUpperCase()) {
	  browserName = navigator.appName;
	 }
	}
	
	if ((ix=fullVersion.indexOf(';'))!=-1)
	   fullVersion=fullVersion.substring(0,ix);
	if ((ix=fullVersion.indexOf(' '))!=-1)
	   fullVersion=fullVersion.substring(0,ix);

	majorVersion = parseInt(''+fullVersion,10);
	if (isNaN(majorVersion)) {
	 fullVersion  = ''+parseFloat(navigator.appVersion); 
	 majorVersion = parseInt(navigator.appVersion,10);
	}
	
	var url = window.location.href;
	var urlNew = url.replace("/#/", "/");
	
	var sku = '';
	var action = 'PageView';
	var browserName = browserName;
	var browserVersion = fullVersion; 
	var geolocation = navigator.geolocarion; 
	var language = navigator.language; 
	var plataform = navigator.plataform;
	var retailerDomain = window.location.hostname;
	var monitored = 'false';

	function createCookie(name,value,days) {
		var expires = '';
		if (days) {
			var date = new Date();
			date.setTime(date.getTime() + (days*24*60*60*1000));
			expires = '; expires=' + date.toUTCString();
		}
		document.cookie = name + '=' + value + expires + '; path=/';
	}

	function guid() {
	  function s4() {
		return Math.floor((1 + Math.random()) * 0x10000)
		  .toString(16)
		  .substring(1);
	  }
	  return s4() + s4() + '-' + s4() + '-' + s4() + '-' +
		s4() + '-' + s4() + s4() + s4();
	}


	String.prototype.includes = function (str) {
	  var returnValue = false;

	  if (this.indexOf(str) !== -1) {
		returnValue = true;
	  }

	  return returnValue;
	}

	function getStandoutCookie(){
		 var arrayCookie = document.cookie.split(';');
		 for(var i = 0; i < arrayCookie.length; i++)
		 {
			if(arrayCookie[i].includes('StandoutTag'))
			{
				var retorno = arrayCookie[i].replace('StandoutTag=','');
				return retorno.trim();
			}
		 }
		 return '';
	};

	var cookie = getStandoutCookie();
	if(cookie == '')
	{
		var randomValue = guid();
		createCookie('StandoutTag', randomValue, 365);
		cookie =  getStandoutCookie();
	}

	var distributor = "livrariacultura";
	var data = "distributor="+distributor+"&sku="+sku+"&url="+urlNew+"&action="+action+"&browserName="+browserName+"&browserVersion="+browserVersion+"&geolocation="+geolocation+"&language="+language+"&plataform="+plataform+"&cookie="+cookie+"&monitored="+monitored+"&bot="+bot;
	var urlCatch = 'https://standout.com.br/'+distributor+'/catchtag.php?'+data;
		
	setTimeout(function () { 	
		var xmlhttp = new XMLHttpRequest();
		xmlhttp.onreadystatechange = function() {
		  if (this.readyState == 4 && this.status == 200) {
			var myObj = JSON.parse(this.responseText);
			console.log(myObj);
			
			var fullVitrineUrl = window.location.href.split("/");
			if(document.getElementById("standoutDivAutomatico") == null) {
				console.log("no standoutDivAutomatico");
				$("#product-description").append('\x3cdiv id\x3d"standoutDivAutomatico"\x3e\x3c/div\x3e');
			}
			
			
			document.getElementById("standoutDivAutomatico").innerHTML = myObj.div;
			writeStandoutCBP();
		  }
		};
		xmlhttp.open("GET", urlCatch, true);
		xmlhttp.send();
		
	}, 1000);
		
	function writeStandout(d){document.getElementsById("standoutDiv").getAttribute("h") = d.productHeight; writeStandoutCBP();}
	function writeStandoutCBP(){
		if(document.getElementById("standoutDiv") != null){
			if(document.getElementById("standoutDiv").getAttribute("h") != null || document.getElementById("standoutDiv").getAttribute("h") != "undefined") {
				var elem=document.getElementById("standoutDiv");var w='100%';var h=parseInt(elem.getAttribute("h"));var hm=parseInt(elem.getAttribute("hm"));

				h=(parseInt(window.innerWidth)>=840 || parseInt(window.innerWidth) <= 420)?h:parseInt((Math.round((hm*320)/window.innerWidth))+200);
				//h=(parseInt(window.innerWidth)>=840)?h:parseInt((Math.round((h*window.innerWidth)/840)));
				
				var p=((elem.getAttribute("p") === null)?'oroMjbxuLBI,':elem.getAttribute("p"))+'/'+elem.getAttribute("x")+'/'+elem.getAttribute("y");
				var c=elem.getAttribute("i");
				elem.innerHTML = '<iframe width="'+w+'" height="'+parseInt(h)+'" src="//www.standout.com.br/'+c+'/p/'+p+'" frameborder="0" id="frameStandout" allowfullscreen></iframe>'; 
				/*
				if (browserName=="Firefox") { var mydiv = $("#frameStandout").contents().find('body').html(html); } else{ var mydiv = $("#frameStandout").contents().find('body').html('html'); } var myHeight = mydiv.height();
				if (myHeight<0) { document.getElementById("frameStandout").height =  (myHeight<0)?0:(myHeight==0)?parseInt(h):myHeight; }
				*/
			}
		}
	}
	
}

	

			