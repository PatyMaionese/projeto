var windowProxy;var survey=new Survey();var pluginTypeId=10;var CID='6d181fa9-f60a-493d-84db-b56f805cefdf';var signIn=function(event){$(".step-1").addClass('step-loading');$("p.poweredby").hide(0);var delayLogin=checkDelayLogin(event);if(!delayLogin){soclConnect.signIn(CID,appConfig.pluginType.SocialBounceSurvey.Id,soclHelper.getQueryStringParams("scope"),'none',function(response){if(response){soclPerfCounter.event(soclHelper.getQueryStringParams("pluginId"),soclPerfCounter.type.Click,pluginTypeId,soclHelper.getQueryStringParams("id"));windowProxy.post({'click':'click'});loadProfile();survey.start();}});}
else{survey.start(delayLogin);}};var checkDelayLogin=function(event){return(event.currentTarget.getAttribute('delay-login')=='true');}
var loadProfile=function(){soclConnect.fbEnsureInit(function(){FB.api("me?fields=id,first_name,email,picture.width(100).height(100)",function(response){if(response&&!response.error){$('#reward h1').text($('#reward h1').text().replace('{nome}',response.first_name));}})});};var conclude=function(){windowProxy.post({'concluded':'on'});};var closeWindow=function(){windowProxy.post({'close':'on'});};var userIsConnected=function(customerId){soclConnect.getStatus(function(isConnected){if(isConnected){windowProxy.post({'userConnected':customerId});}
else{windowProxy.post({'activeBounce':'on'});}});windowProxy.post({'loaded':$('#btnRedirect').attr('redirect')||"on"});};function Survey(){var STEP_DELAY=1500;var FADE_DURATION=150;var TIMER;this.currentStep=1;this.answers=[];this.locked=false;this.correctAnswers=0;this.start=function(delayLogin){TIMER='.timer';this.bindEvents();this.resetTimer();this.changeStep(2);this.delayLogin=delayLogin;}
this.changeStep=function(nextStep,withTimer){if(withTimer&&jQuery('.step'+this.currentStep+' '+TIMER).size()){jQuery('.step'+this.currentStep+' '+TIMER).animate({width:'100%'},STEP_DELAY,function(){this.activeStep(nextStep)}.bind(this))}else{this.activeStep(nextStep);}}
this.nextStep=function(withTimer){this.changeStep(this.currentStep+1,withTimer);}
this.activeStep=function(step){containerCurrentStep=document.getElementsByClassName('step'+this.currentStep)[0];containerNextStep=document.getElementsByClassName('step'+step)[0];jQuery(containerCurrentStep).fadeOut(FADE_DURATION,function(){containerCurrentStep.classList.remove('active');containerNextStep.classList.add('active');this.resetTimer();jQuery(containerNextStep).fadeIn(FADE_DURATION);this.currentStep=step;this.locked=false;}.bind(this));}
this.resetTimer=function(){jQuery(TIMER).css('width',"0%");}
this.saveAnswers=function(element){this.answers.push({'Question':this.getQuestion(element),'AnswerNumber':this.getAnswerNumber(element),'Answer':this.getAnswerText(element)});}
this.bindEvents=function(){var answers=document.getElementsByClassName('answers');for(var i=0;i<answers.length;i++){answers[i].addEventListener('click',this.onClickAnswers.bind(this));}
var btnConclusion=document.getElementById('btnConclusion');btnConclusion.addEventListener('click',this.onClickGetReward.bind(this));}
this.onClickAnswers=function(e){if(!this.locked){this.locked=true;e.currentTarget.classList.add('myAnswer');this.saveAnswers(e.currentTarget);this.nextStep(true);}}
this.onClickGetReward=function(e){if(!this.delayLogin){this.nextStep(false);}
else{soclConnect.signIn(CID,appConfig.pluginType.SocialBounceSurvey.Id,soclHelper.getQueryStringParams("scope"),'none',function(response){if(response){soclPerfCounter.event(soclHelper.getQueryStringParams("pluginId"),soclPerfCounter.type.Click,pluginTypeId,soclHelper.getQueryStringParams("id"));windowProxy.post({'click':'click'});loadProfile();this.nextStep(false);}}.bind(this));}}
this.getAnswerNumber=function(element){return element.getElementsByTagName('span')[0].textContent;}
this.getAnswerText=function(element){return element.getElementsByTagName('h2')[0].textContent;}
this.getQuestion=function(element){while(element.className!='footer'&&element.nodeName!="BODY"){element=element.parentNode;}
if(element.className=='footer'){return element.previousElementSibling.getElementsByTagName('h1')[0].textContent;}
return '';}}